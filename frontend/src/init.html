<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Dashboard | Soroban DeFi</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.5">
    <!-- App favicon -->
    <!-- <link rel="shortcut icon" href="../images/favicon.ico"> -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- App css -->
    <link href="../assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/css/app.min.css" rel="stylesheet" type="text/css" id="light-style" />
    <link href="../assets/css/app-dark.min.css" rel="stylesheet" type="text/css" id="dark-style">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>




<body class="loading" data-layout="topnav"
    data-layout-config='{"layoutBoxed":false,"darkMode":false,"showRightSidebarOnStart": true}'>
    <div id="app">
        <div class="wrapper">



            <div class="content-page">
                <div class="content">
                    <!-- Topbar Start -->
                    <div class="navbar-custom topnav-navbar">
                        <div class="container-fluid">

                            <!-- LOGO -->
                            <a href="" class="topnav-logo">
                                <span class="topnav-logo-lg">
                                    <img src="../assets/images/soroban.png" alt="" height="66">
                                </span>
                                <!--  -->
                            </a>

                            <ul class="list-unstyled topbar-menu float-end mb-0">



                                <li class="dropdown notification-list">
                                    <a class="nav-link dropdown-toggle nav-user arrow-none me-0"
                                        data-bs-toggle="dropdown" id="topbar-userdrop" href="#" role="button"
                                        aria-haspopup="true" aria-expanded="false">
                                        <span class="account-user-avatar">
                                            <img src="../assets/images/users/avatar-1.jpg" alt="user-image"
                                                class="rounded-circle">
                                        </span>
                                        <span>
                                            <span class="account-user-name">Soeng Souy</span>
                                            <span class="account-position">Founder</span>
                                        </span>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated topbar-dropdown-menu profile-dropdown"
                                        aria-labelledby="topbar-userdrop">
                                        <!-- item-->
                                        <div class=" dropdown-header noti-title">
                                            <h6 class="text-overflow m-0">Welcome !</h6>
                                        </div>

                                        <!-- item-->
                                        <a href="javascript:void(0);" class="dropdown-item notify-item">
                                            <i class="mdi mdi-account-circle me-1"></i>
                                            <span>My Account</span>
                                        </a>

                                    </div>
                                </li>

                            </ul>

                        </div>
                    </div>
                    <!-- end Topbar -->

                    <div class="topnav">
                        <div class="container-fluid">
                            <nav class="navbar navbar-dark navbar-expand-lg topnav-menu">

                                <div class="collapse navbar-collapse" id="topnav-menu-content">
                                    <ul class="navbar-nav">
                                        <li class="nav-item">
                                            <a href="init.html" class="nav-link">Init</a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="dashboard.html" class="nav-link">Dashboard</a>
                                        </li>
                                        
                                        <li class="nav-item">
                                            <a href="borrowing_with_ai.html" class="nav-link">Borrowing with AI</a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="chat.html" class="nav-link">Chat</a>
                                        </li>
                                    </ul>
                                </div>
                            </nav>
                        </div>
                    </div>



                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-10">
                                <div class="page-title-box">
                                    <h4 class="page-title">Create Account and Deploy</h4>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="mb-3">
                                    <label for="simpleinput" class="form-label">Enter your Secret Key</label>
                                    <input type="text" id="simpleinput" class="form-control" v-model="secretkey">
                                </div>
                            </div>
                            <div class="col-1">
                                <label for="simpleinput" class="form-label"></label>
                                <p style="margin-top: 12px;">or </p>
                            </div>
                            <div class="col-2">
                                <div class="page-title" style="margin-top: 28px;">
                                    <button type="button" class="btn btn-primary" @click="createAccount()">Create
                                        Account</button>
                                </div>
                            </div>
                        </div>
                        <div v-if="true">

                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Enter Contract name</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="contract_name">
                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Enter Contract path</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="contract_path">
                                    </div>
                                </div>

                            </div>

                            <div class="page-title" style="margin-top: 28px;">
                                <button type="button" class="btn btn-primary" @click="deployContract()"> Deploy Contract</button>
                            </div>

                            <br>
                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Token owner</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="token_owner">
                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Initial Token to generate</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="initial_amount">
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Token Name</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="token_name">
                                    </div>
                                </div>

                            </div>
                            <div class="row" v-if="token_name == 'sb'">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Enter 'To' address</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="toAddress">
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Token Symbol</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="token_symbol">
                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="simpleinput" class="form-label">Enter Contract Id</label>
                                        <input type="text" id="simpleinput" class="form-control"
                                            v-model="contract_id">
                                    </div>
                                </div>

                            </div>

                            <div class="page-title" style="margin-top: 28px;">
                                <button type="button" class="btn btn-primary" @click="initializeTokens()"> Initialize Tokens</button>
                            </div>
                        </div>




                    </div>

                </div>
                <div class="d-flex justify-content-center align-items-center" v-if="alert">
                    <div  class="alert alert-primary" role="alert" style="width: 300px;">
                        <p>{{ message }}</p>
                    </div>
                </div>

            </div>
            <!-- end page -->

        </div>
    </div>

    <!-- bundle -->
    <script type="text/javascript" src="../assets/js/vendor.min.js"></script>
    <script type="text/javascript" src="../assets/js/app.min.js"></script>
    <script type="module">
        var app = new Vue({
            el: "#app",
            data: {
                secretkey: "",
                contract_name: "",
                contract_path: "",
                message : "",
                alert : false,
                contracts : [],
                token_owner : "",
                initial_amount : "",
                token_name : "",
                token_symbol : "",
                contract_id : "",
                toAddress : "",
            },
            mounted() {
                this.contracts = JSON.parse(sessionStorage.getItem("contracts"))
                console.log(this.contracts)
                if(this.contracts === null)
                    this.contracts = []
                console.log(this.contracts)
            },
            methods: {
                createAccount() {
                    var url = 'https://laboratory.stellar.org/#account-creator?network=futurenet';
                    window.open(url, '_blank');
                },
                async deployContract() {
                    this.alert = true
                    const params = {
                        secretkey : this.secretkey,
                        contract_name : this.contract_name,
                        contract_path : this.contract_path,
                        
                    };
                    this.message = "Deploying Contract..."
                    await axios.post('http://127.0.0.1:3000/api/deploy', {
                        params : params
                    })
                        .then(response => {
                            let res = response.data;
                            
                            console.log(response.data)
                            if(res.status === "success"){
                                this.message = "Deployed Successfully"
                                console.log(this.contracts)
                                this.contracts.push({
                                    "contractName" : this.contract_name,
                                    "contractId" : res.contractId
                                })
                                console.log(this.contracts)
                                sessionStorage.removeItem("contracts")
                                sessionStorage.setItem("contracts", JSON.stringify(this.contracts))
                            }
                            else{
                                this.message = "Deployment Failed" + res.reason
                            }

                            setTimeout(() =>{
                                this.alert = false
                            }, 3000)
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                        });
                },
                async initializeTokens(){
                    this.alert = true
                    const params = {
                        secretkey : this.secretkey,
                        contractId : this.contract_id,
                        tokenOwner : this.token_owner,
                        tokenName : this.token_name,
                        initialAmount : this.initial_amount,
                        tokenSymbol : this.token_symbol,
                        toAddress : this.toAddress
                    };
                    this.message = "Deploying Contract..."
                    await axios.post('http://127.0.0.1:3000/api/initialize', {
                        params : params
                    })
                        .then(response => {
                            let res = response.data;
                            
                            console.log(response.data)
                            if(res.status === "success"){
                                this.message = "Initialzed  Successfully"
                                
                            }
                            else{
                                this.message = "Initialization  Failed"
                            }

                            setTimeout(() =>{
                                this.alert = false
                            }, 3000)
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                        });
                }

            },
        })    
    </script>



</body>

</head>